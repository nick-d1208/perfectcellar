var handlerController=function(){"use strict";function t(t,e,i){$.ajax({url:n+t.url+("undefined"!=typeof t.ajaxParams?t.ajaxParams:""),type:"POST",headers:{},dataType:t.dataType||"json",data:JSON.stringify(t.data),success:function(t){try{var i;"object"==typeof t?i=t:(t=JSON.stringify(t),i=JSON.parse(t)),"function"==typeof e&&e(i)}catch(n){}},complete:function(){},error:function(t,e,n){return t.status>=400?void("function"==typeof i&&i(t.responseText)):void("function"==typeof i&&i(t.responseText))}})}function e(t,e,i){$.ajax({url:t.url,type:"GET",success:function(t){var i={yotpo:"",quizzes:[],lessons:[],wines:[]};try{var n=document.createElement("div");n.innerHTML=t;for(var s=n.getElementsByTagName("script"),r=s.length;r--;)s[r].parentNode.removeChild(s[r]);var o=$(n.innerHTML),u=o.find("#quizzes"),a=o.find("#lessons"),d=o.find("#wines"),f=o.find("#wines-ratings");u.find(">div").each(function(){var t=$(this),e=Number(t.attr("quiz"))-1,n=t.attr("name"),s=t.attr("img"),r={index:e,name:n,img:s,questions:[]};t.find("strong").each(function(e){var i=$.trim($(this).text()),n=[],s=0;t.find("ul").eq(e).find("li").each(function(t){$(this).find("a").length&&(s=t),n.push($.trim($(this).text()))}),r.questions.push({q:i,a:n,c:s})}),i.quizzes.push(r)}),i.quizzes.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),a.find(">div").each(function(){var t=$(this),e=Number(t.attr("set"))-1,n=[];t.find(">div").each(function(){var t={set:e,index:Number($(this).attr("lesson"))-1,title:$(this).find(">.title").text(),subtitle:$(this).find(">.subtitle").text(),imgs:{top:$(this).find(">.top-image").text(),middle:$(this).find(">.middle-image").text()},videos:{top:$(this).find(">.top-video").text(),bottom:$(this).find(">.bottom-video").text()},parts:[]};$(this).find(">.part").each(function(){var e={name:"part "+$(this).attr("number"),index:Number($(this).attr("index"))-1,icon:$(this).find(">.icon").text(),title:$(this).find(">.title").text(),subtitle:$(this).find(">.subtitle").text(),img:$(this).find(">.img").text(),p:[]};$(this).find(">.p").each(function(){e.p.push($(this).html())}),t.parts.push(e)}),t.parts.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),n.push(t)}),n.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),i.lessons.push(n)}),i.lessons.sort(function(t,e){return t[0].set>e[0].set?1:e[0].set>t[0].set?-1:0}),d.find(">[set]").each(function(){var t=$(this),e=Number(t.attr("set"))-1,n=[];t.find(">div").each(function(){var t=Number($(this).attr("wine")),i={price:$(this).find(">.price").text(),purl:$(this).attr("url"),variant:$(this).attr("vid"),set:e,index:t-1,title:$(this).find(">.title").text(),subtitle:$(this).find(">.subtitle").text(),img:$(this).find(">.top-image").text(),sections:[],video:$(this).find(">.bottom-video").text(),pimg:$(this).find(">.pimage").text(),rating:f.find('[set="'+(e+1)+'"][wine="'+t+'"]').html()};$(this).find(">[section]").each(function(){var t={index:Number($(this).attr("section"))-1,title:$(this).find(">.title").text(),img:$(this).find(">.image").text(),p:[],video:$(this).find(">.video").text()};$(this).find(">.p").each(function(){t.p.push($(this).html())}),i.sections.push(t)}),i.sections.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),n.push(i)}),n.sort(function(t,e){return t.index>e.index?1:e.index>t.index?-1:0}),i.wines.push(n)}),i.wines.sort(function(t,e){return t[0].set>e[0].set?1:e[0].set>t[0].set?-1:0}),i.discount={value:Number(d.find(">.discount-value").text()),text:d.find(">.discount-text").text()},i.yotpo=f.attr("url")}catch(c){return i=null,!1}"function"==typeof e&&e(i)},complete:function(){},error:function(t,e,n){return t.status>=400?void("function"==typeof i&&i(t.responseText)):void("function"==typeof i&&i(t.responseText))}})}var i={},n="http://www.perfcellapi.vitaminlabs.co.uk/",s="logIn.php",r="getUInfo.php",o="logOut.php",u="forgotPasswd.php",a="http://www.perfectcellar.com/pages/e2-98-15-d5-f7-ed-3a-9f-c7-4b";return i.content=function(t,i,n){if("object"!=typeof t)return!1;var s={url:a+objectToAjaxParameters({time:(new moment).unix()})};e(s,i,n)},i.getinfo=function(e,i,n){if("object"!=typeof e)return!1;var s={url:r,data:e};t(s,i,n)},i.forgotpassword=function(e,i,n){if("object"!=typeof e)return!1;var s={url:u,data:e};t(s,i,n)},i.login=function(e,i,n){if("object"!=typeof e)return!1;var r={url:s,data:e};t(r,i,n)},i.logout=function(e,i,n){if("object"!=typeof e)return!1;var s={url:o,data:e};t(s,i,n)},i}();